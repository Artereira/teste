<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Scraper Personalizado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üï∑Ô∏è Web Scraper Avan√ßado</h1>
            <p>Ferramenta profissional para extra√ß√£o de dados</p>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="web-scraping-tab">üåê Scraping Web</button>
            <button class="tab-button" data-tab="google-maps-tab">üó∫Ô∏è Google Maps</button>
            <button class="tab-button" data-tab="data-management-tab">üîç Gerenciamento</button>
        </div>

        <!-- Web Scraping Tab -->
        <div id="web-scraping-tab" class="tab-content active">
            <div class="section">
                <h2>‚öôÔ∏è Configura√ß√£o do Scraping de Im√≥veis</h2>
                <form action="/scrape" method="post" id="scrapeForm">
                    <div class="input-group">
                        <label for="url"><i class="fas fa-link"></i> URL do Site:</label>
                        <input type="url" id="url" name="url" placeholder="https://exemplo.com" required>
                        <div class="url-status" id="urlStatus"></div>
                    </div>
                    
                    <div class="options-group">
                        <h3><i class="fas fa-cog"></i> Op√ß√µes Avan√ßadas</h3>
                        <div class="checkbox-group">
                            <input type="checkbox" id="scrollInfinite" name="scroll_infinite" checked>
                            <label for="scrollInfinite">Rolagem infinita autom√°tica</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="removeDuplicates" name="remove_duplicates" checked>
                            <label for="removeDuplicates">Remover duplicatas</label>
                        </div>

                    </div>
                    
                    <div class="selectors-section">
                        <h3><i class="fas fa-code"></i> Seletores CSS Personalizados</h3>
                        <div class="selector-group">
                            <label for="link_selector">Seletor de Links:</label>
                            <input type="text" id="link_selector" name="link_selector" 
                                   value="a[href*='/imovel/'], a[href*='/pt/imoveis/'], a.property-card, .property-link" 
                                   placeholder="Ex: a[href*='/imovel/']">
                            <small>Seletor CSS para encontrar os links dos im√≥veis</small>
                        </div>
                        <div class="selector-group">
                            <label for="name_selector">Seletor de Nome/T√≠tulo:</label>
                            <input type="text" id="name_selector" name="name_selector" 
                                   value="h1.property-title, .titulo-imovel, h1.title, .property-name, p.leading-9" 
                                   placeholder="Ex: h1.property-title">
                            <small>Seletor CSS para extrair o t√≠tulo do im√≥vel</small>
                        </div>
                        <div class="selector-group">
                            <label for="price_selector">Seletor de Pre√ßo:</label>
                            <input type="text" id="price_selector" name="price_selector" 
                                   value=".property-price, .valor, .price, .preco, span.value, h2.leading-10 b span" 
                                   placeholder="Ex: .property-price">
                            <small>Seletor CSS para extrair o pre√ßo do im√≥vel</small>
                        </div>
                        <div class="selector-group">
                            <label for="description_selector">Seletor de Descri√ß√£o:</label>
                            <input type="text" id="description_selector" name="description_selector" 
                                   value=".property-description, .descricao, .description, .detalhes-imovel, div.custom-description p" 
                                   placeholder="Ex: .property-description">
                            <small>Seletor CSS para extrair a descri√ß√£o do im√≥vel</small>
                        </div>
                        <div class="selector-group">
                            <label for="details_selector">Seletor de Detalhes:</label>
                            <input type="text" id="details_selector" name="details_selector" 
                                   value=".property-details, .caracteristicas, .features, .detalhes, div.gap-x-14 div span" 
                                   placeholder="Ex: .property-details">
                            <small>Seletor CSS para extrair os detalhes do im√≥vel (quartos, banheiros, etc.)</small>
                        </div>
                        <div class="selector-group">
                            <label for="image_selector">Seletor de Links de Imagens:</label>
                            <input type="text" id="image_selector" name="image_selector" 
                                   value=".property-image, .foto-imovel, .carousel img, .gallery img, .slider img, img.object-center" 
                                   placeholder="Ex: .property-image">
                            <small>Seletor CSS para extrair os links de imagens do im√≥vel</small>
                        </div>
                        <div class="selector-group">
                            <label for="limit_page">Limite de p√°ginas</label>
                            <input type="number" id="limit_page" name="limit_page" 
                                   value="35" 
                                   placeholder="35">
                            <small>Quantas p√°ginas de imoveis v√£o ser extraidas</small>
                        </div>
                        <div class="selector-group">
                            <label for="dominio_wordpress">O dominio do wordpress:</label>
                            <input type="text" id="dominio_wordpress" name="dominio_wordpress" 
                                   value="" 
                                   placeholder="Ex: seudominio.com">
                            <small>Ex: seudominio.com<br>
                                        O dominio do seu site wordpress sem o https:// e sem a barra no final
                            </small>
                        </div>
                        <div class="selector-group">
                            <label for="wordpress_user">O usu√°rio do wordpress:</label>
                            <input type="text" id="wordpress_user" name="wordpress_user" 
                                   value="" 
                                   placeholder="">
                            <small>O nome do usu√°rio do wordpress</small>
                        </div>
                        <div class="selector-group">
                            <label for="wordpress_password">A senha de integra√ß√£o do wordpress:</label>
                            <input type="text" id="wordpress_password" name="wordpress_password" 
                                   value="" 
                                   placeholder="">
                            <small>A senha de integra√ß√£o de seu usu√°rio wordpress</small>
                        </div>
                    </div>
                    
                    <button type="submit" id="submitBtn">
                        <i class="fas fa-play"></i> Iniciar Coleta
                    </button>
                </form>
                
                <div id="progressContainer" class="progress-container" style="display: none;">
                    <h3><i class="fas fa-spinner fa-spin"></i> Coletando dados...</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Iniciando...</div>
                </div>
                
                {% if mensagem %}
                <div class="message {{ 'success' if 'finalizada' in mensagem else 'error' }}">
                    <i class="fas {{ 'fa-check-circle' if 'finalizada' in mensagem else 'fa-exclamation-triangle' }}"></i>
                    {{ mensagem }}
                </div>
                {% endif %}
                
                <div class="stats-container">
                    <h3><i class="fas fa-chart-bar"></i> Estat√≠sticas</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-number" id="total-registros">{{ total_registros or 0 }}</span>
                            <span class="stat-label">Total de Registros</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="novos-registros">{{ novos_registros or 0 }}</span>
                            <span class="stat-label">Novos Registros</span>
                        </div>
                    </div>
                </div>
                
                <div class="download-container" id="download-section" style="display: none;">
                    <h3><i class="fas fa-download"></i> Exportar Dados</h3>
                    <div class="download-buttons">
                        <button type="button" class="download-btn csv-btn" onclick="downloadData('csv')">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button type="button" class="download-btn json-btn" onclick="downloadData('json')">
                            <i class="fas fa-file-code"></i> JSON
                        </button>
                        <button type="button" class="download-btn excel-btn" onclick="downloadData('excel')">
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Google Maps Tab -->
        <div id="google-maps-tab" class="tab-content">
            <div class="section">
                <h2>üó∫Ô∏è Busca no Google Maps</h2>
                <form id="maps-form">
                    <div class="input-group">
                        <label for="termo-busca">Termo de Busca:</label>
                        <input type="text" id="termo-busca" name="termo-busca" placeholder="Ex: restaurantes em S√£o Paulo, dentistas Rio de Janeiro..." required>
                        <small>Digite o que voc√™ quer buscar no Google Maps (estabelecimentos, servi√ßos, etc.)</small>
                    </div>
                    
                    <div class="input-group">
                        <label for="max-resultados-maps">M√°ximo de Resultados:</label>
                        <input type="number" id="max-resultados-maps" name="max-resultados-maps" value="50" min="10" max="200">
                        <small>Quantidade m√°xima de estabelecimentos para coletar (10-200)</small>
                    </div>
                    
                    <button type="submit" id="btn-maps" class="btn-primary">üöÄ Buscar no Google Maps</button>
                </form>
                
                <!-- Progress Maps -->
                <div id="progress-maps" class="progress-container" style="display: none;">
                    <div class="progress-info">
                        <span id="progress-text-maps">Preparando busca...</span>
                        <span id="progress-percent-maps">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progress-fill-maps" class="progress-fill"></div>
                    </div>
                </div>
                
                <!-- Statistics Maps -->
                <div id="statistics-maps" class="statistics" style="display: none;">
                    <h3>üìä Estat√≠sticas da Busca</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Estabelecimentos Encontrados:</span>
                            <span id="total-estabelecimentos" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Status:</span>
                            <span id="status-busca-maps" class="stat-value">Aguardando</span>
                        </div>
                    </div>
                </div>
                
                <!-- Results Maps -->
                <div id="results-maps" class="results" style="display: none;">
                    <h3>üè™ Estabelecimentos Encontrados</h3>
                    <div id="results-table-maps"></div>
                </div>
                
                <!-- Download Maps -->
                <div id="download-maps" class="download-section" style="display: none;">
                    <h3>üì• Download dos Resultados</h3>
                    <div class="download-buttons">
                        <a href="/download_maps/csv" class="btn-download" target="_blank">üìÑ CSV</a>
                        <a href="/download_maps/json" class="btn-download" target="_blank">üìã JSON</a>
                        <a href="/download_maps/excel" class="btn-download" target="_blank">üìä Excel</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Tab -->
        <div id="data-management-tab" class="tab-content">
            <div class="section">
                <h2>üîç Gerenciamento de Dados</h2>
                
                <!-- Search Section -->
                <div class="search-section">
                    <h4>Pesquisar Registros</h4>
                    <div class="search-input-group">
                        <input type="text" id="searchInput" placeholder="Digite o nome ou telefone para pesquisar...">
                        <button onclick="searchData()" class="search-btn">üîç Pesquisar</button>
                        <button onclick="clearSearch()" class="clear-btn">üóëÔ∏è Limpar</button>
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </div>
                
                <!-- Clean Duplicates Section -->
                <div class="clean-section">
                    <h4>Limpar Duplicatas</h4>
                    <p class="clean-description">Remove registros duplicados baseado no nome do consultor.</p>
                    <button onclick="cleanDuplicates()" class="clean-btn">üßπ Limpar Duplicatas</button>
                    <div id="cleanResults" class="clean-results"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>